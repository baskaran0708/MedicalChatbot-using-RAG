<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>MediBot - Chat</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='chat-style.css') }}">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>
	<div class="chat-container">
		<!-- Header -->
		<div class="chat-header">
			<a href="/" class="back-button">
				<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2"
						stroke-linecap="round" stroke-linejoin="round" />
				</svg>
			</a>
			<div class="header-info">
				<div class="bot-avatar">
					<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M12 2L2 7V12C2 16.97 5.84 21.5 12 22C18.16 21.5 22 16.97 22 12V7L12 2Z"
							stroke="currentColor" stroke-width="2" />
					</svg>
				</div>
				<div>
					<h1>MediBot</h1>
					<p class="status"><span class="status-dot"></span>Online</p>
				</div>
			</div>
		</div>

		<!-- Messages Area -->
		<div id="messageArea" class="messages-container"></div>

		<!-- Input Area -->
		<div class="input-container">
			<form id="chatForm" class="chat-form">
				<input type="text" id="messageInput" name="msg"
					placeholder="Ask me about medical conditions, symptoms, treatments..." autocomplete="off"
					required />
				<button type="submit" class="send-button">
					<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 8L11 13" stroke="currentColor" stroke-width="2"
							stroke-linecap="round" stroke-linejoin="round" />
					</svg>
				</button>
			</form>
		</div>
	</div>

	<script>
		const messageArea = document.getElementById('messageArea');
		const chatForm = document.getElementById('chatForm');
		const messageInput = document.getElementById('messageInput');

		// Add welcome message
		addBotMessage("Hello! I'm MediBot, your AI medical assistant. How can I help you today?");

		chatForm.addEventListener('submit', async (e) => {
			e.preventDefault();

			const message = messageInput.value.trim();
			if (!message) return;

			// Add user message
			addUserMessage(message);
			messageInput.value = '';

			// Show typing indicator
			const typingId = showTyping();

			try {
				// Send message to backend
				const formData = new FormData();
				formData.append('msg', message);

				const response = await fetch('/get', {
					method: 'POST',
					body: formData
				});

				const data = await response.text();

				// Remove typing indicator
				removeTyping(typingId);

				// Add bot response
				addBotMessage(data);
			} catch (error) {
				removeTyping(typingId);
				addBotMessage('Sorry, something went wrong. Please try again.');
			}
		});

		function addUserMessage(text) {
			const messageDiv = document.createElement('div');
			messageDiv.className = 'message user-message slide-in';
			messageDiv.innerHTML = `
                <div class="message-content">${escapeHtml(text)}</div>
                <div class="message-time">${getCurrentTime()}</div>
            `;
			messageArea.appendChild(messageDiv);
			scrollToBottom();
		}

		function addBotMessage(text) {
			const messageDiv = document.createElement('div');
			messageDiv.className = 'message bot-message slide-in';
			messageDiv.innerHTML = `
                <div class="bot-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7V12C2 16.97 5.84 21.5 12 22C18.16 21.5 22 16.97 22 12V7L12 2Z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </div>
                <div class="message-content">${escapeHtml(text)}</div>
                <div class="message-time">${getCurrentTime()}</div>
            `;
			messageArea.appendChild(messageDiv);
			scrollToBottom();
		}

		function showTyping() {
			const typingDiv = document.createElement('div');
			typingDiv.className = 'message bot-message typing-indicator';
			typingDiv.id = 'typing-' + Date.now();
			typingDiv.innerHTML = `
                <div class="bot-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7V12C2 16.97 5.84 21.5 12 22C18.16 21.5 22 16.97 22 12V7L12 2Z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </div>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
			messageArea.appendChild(typingDiv);
			scrollToBottom();
			return typingDiv.id;
		}

		function removeTyping(id) {
			const typingDiv = document.getElementById(id);
			if (typingDiv) typingDiv.remove();
		}

		function scrollToBottom() {
			messageArea.scrollTop = messageArea.scrollHeight;
		}

		function getCurrentTime() {
			const now = new Date();
			return now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
		}

		function escapeHtml(text) {
			const div = document.createElement('div');
			div.textContent = text;
			return div.innerHTML;
		}
	</script>
</body>

</html>